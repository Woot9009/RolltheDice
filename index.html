<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap" rel="stylesheet"/><!--ì›¹í°íŠ¸ "Shadows Into Light"-->
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet"/><!--ì›¹í°íŠ¸ "Source Code Pro"-->
    <script src="https://unpkg.com/typeit@8.7.1/dist/index.umd.js"></script><!--TypeIt ë¼ì´ë¸ŒëŸ¬ë¦¬-->
    <title>Roll the Dice</title>
    <link rel="stylesheet" href="css/scoreboard.css" />
  </head>

  <body>
    <div id="wrapper">
      <div id="page1">
        <h1 id="title">Roll the Dice.</h1>
        <h1 id="caesar"></h1>
        <section id="diceAnimation" onclick="diceAnimation(this)">
          <div class="dice dice1">
            <span></span>
          </div>
          <div class="dice dice2">
            <span></span>
            <span></span>
          </div>
          <div class="dice dice3">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="dice dice4">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="dice dice5">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="dice dice6">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
        </section>
      </div><!--page1 ë-->

      <div id="page2">
        <h2>ì¸ì›ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
        <button onclick="setPlayers()">í™•ì¸</button>
        <div id="tabSection">
          <div id="numPlayers">2</div>
          <div class="increaseNum" onclick="increaseNum()"></div>
          <div class="decreaseNum" onclick="decreaseNum()"></div>
          <img class="basicAvatar" src="images/group_right_resize.png" alt="penguins" width="45px"/>

          <img class="avatar avatar1" src="images/avatar_1.png" alt="penguin" height="100px" />
          <img class="avatar avatar2" src="images/avatar_2.png" alt="penguin" height="100px" />
          <img class="avatar avatar3" src="images/avatar_3.png" alt="penguin" height="100px" />
          <img class="avatar avatar4" src="images/avatar_4.png" alt="penguin" height="100px" />
          <img class="avatar avatar5" src="images/avatar_5.png" alt="penguin" height="80px" />
          <img class="avatar avatar6" src="images/avatar_6.png" alt="penguin" height="80px" />
        </div>
      </div><!--page2 ë-->

      <div id="page3">
        <div id="playerList"></div>
        <button id="saveName" onclick="saveName()" disabled>ì´ë¦„ ì €ì¥</button>
        <button id="saveScores" onclick="saveScores()" disabled>ì ìˆ˜ ì…ë ¥</button>
        <div id="rankings"></div>
        <p id="scoreListBtn" onclick="toggleScoreList()">ë¼ìš´ë“œ ê¸°ë¡ğŸ§¾</p>
        <div id="scoreList"></div>
      </div><!--page3 ë-->
    </div><!--wrapper ë-->

    <script>
      const page1 = document.getElementById('page1');
      const page2 = document.getElementById('page2');
      const page3 = document.getElementById('page3');
      const dice = document.getElementById('diceAnimation');
      const title = document.getElementById('title');
      const saveNameBtn = document.getElementById('saveName');
      const saveScoresBtn = document.getElementById('saveScores');
      const scoreListBtn = document.getElementById('scoreListBtn');
      const scoreListDiv = document.getElementById('scoreList');

      //ì£¼ì‚¬ìœ„ ë° TypeIt ì• ë‹ˆë©”ì´ì…˜
      function diceAnimation(e) {
        dice.setAttribute('class', 'diceAnimation');
        title.style.display = 'none';
        new TypeIt('#caesar')
          .type('The dice is cast..??')
          .pause(500)
          .delete(4, { delay: 600 })
          .type(' !!!')
          .go();
        setTimeout(function () {
          page1.style.display = 'none';
          page2.style.display = 'block';
        }, 6000);
      }

      //ì¸ì›ìˆ˜ ì„¤ì •
      let numPlayers = 2;
      function increaseNum() {
        if (numPlayers >= 8) {
          return false;
        } else {
          numPlayers++;
        }
        document.getElementById('numPlayers').innerHTML = numPlayers;
        switch (numPlayers) {
          case 3:
            document.querySelector('.avatar1').style.opacity = 1;
            break;
          case 4:
            document.querySelector('.avatar2').style.opacity = 1;
            break;
          case 5:
            document.querySelector('.avatar3').style.opacity = 1;
            break;
          case 6:
            document.querySelector('.avatar4').style.opacity = 1;
            break;
          case 7:
            document.querySelector('.avatar5').style.opacity = 1;
            break;
          case 8:
            document.querySelector('.avatar6').style.opacity = 1;
            break;
        }
      }
      function decreaseNum() {
        if (numPlayers <= 2) {
          return false;
        } else {
          numPlayers--;
        }
        document.getElementById('numPlayers').innerHTML = numPlayers;
        switch (numPlayers) {
          case 2:
            document.querySelector('.avatar1').style.opacity = 0;
            break;
          case 3:
            document.querySelector('.avatar2').style.opacity = 0;
            break;
          case 4:
            document.querySelector('.avatar3').style.opacity = 0;
            break;
          case 5:
            document.querySelector('.avatar4').style.opacity = 0;
            break;
          case 6:
            document.querySelector('.avatar5').style.opacity = 0;
            break;
          case 7:
            document.querySelector('.avatar6').style.opacity = 0;
            break;
        }
      }

      //ì„¤ì •í•œ ì¸ì›ìˆ˜ë§Œí¼ í”Œë ˆì´ì–´ ë° ì…ë ¥ì–‘ì‹ ì¶”ê°€
      let players = [];
      function setPlayers() {
        page2.style.display = 'none';
        page3.style.display = 'block';
        const playerListDiv = document.getElementById('playerList');

        for (let i = 0; i < numPlayers; i++) {
          const playerDiv = document.createElement('div');
          playerDiv.className = 'player';

          const nameLabel = document.createElement('label');
          nameLabel.textContent = `Player ${i + 1}: `;
          playerDiv.appendChild(nameLabel);

          const nameInput = document.createElement('input');
          nameInput.type = 'text';
          nameInput.placeholder = 'ì´ë¦„';
          nameInput.maxLength = 8;
          nameInput.className = 'name';
          playerDiv.appendChild(nameInput);

          const scoreInput = document.createElement('input');
          scoreInput.type = 'text';
          scoreInput.placeholder = 'ë¼ìš´ë“œë³„ ìˆœìœ„';
          scoreInput.setAttribute('oninput', "this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');");//ì—ëŸ¬ë°©ì§€ìš© ìˆ«ìì •ê·œí‘œí˜„ì‹
          scoreInput.className = 'scoreInput';
          playerDiv.appendChild(scoreInput);

          players.push({
            name: nameInput,
            score: scoreInput,
            totalScore: 0,
          });

          playerListDiv.appendChild(playerDiv);
        }

        //ì—ëŸ¬ë°©ì§€ìš© ì¡°ê±´ë¶€ ì´ë¦„ì €ì¥ë²„íŠ¼ í™œì„±í™”
        const nameCheck = document.querySelectorAll('.name');
        nameCheck.forEach((input) => {
          input.addEventListener('input', () => {
            const nameFilled = Array.from(nameCheck).every((input) => input.value !== '');
            saveNameBtn.disabled = !nameFilled;
          });
        });
      }

      //ì—ëŸ¬ë°©ì§€ìš© ì¡°ê±´ë¶€ ì ìˆ˜ì…ë ¥ë²„íŠ¼ í™œì„±í™”
      function scoreCheck() {
        let scores = document.querySelectorAll('.scoreInput');
        scores.forEach((input) => {
          input.addEventListener('input', () => {
            const scoreFilled = Array.from(scores).every((input) => input.value !== '');
            saveScoresBtn.disabled = !scoreFilled;
          });
        });
      }

      //ì´ë¦„ì €ì¥ë²„íŠ¼ ëˆ„ë¥´ë©´ ì ìˆ˜ì…ë ¥ë²„íŠ¼ìœ¼ë¡œ ë°”ë€Œê³ , ì ìˆ˜inputê³¼ ë¼ìš´ë“œê¸°ë¡ë²„íŠ¼ ë“œëŸ¬ë‚˜ë„ë¡
      function saveName() {
        const names = document.querySelectorAll('.name');
        let scores = document.querySelectorAll('.scoreInput');
        for (let i = 0; i < names.length; i++) {
          scores.item(i).style.opacity = 1;
          names.item(i).disabled = true;
        }
        saveNameBtn.style.display = 'none';
        saveScoresBtn.style.display = 'block';
        scoreListBtn.style.display = 'block';

        scoreCheck();
      }

      function saveScores() {
        const scoreListDiv = document.getElementById('scoreList');
        const scoreList = [];

        //ê°œì¸ë³„ ì ìˆ˜ê¸°ë¡
        for (let i = 0; i < players.length; i++) {
          const player = players[i];
          player.totalScore += parseInt(player.score.value);
          scoreList.push({ name: player.name.value, score: player.totalScore });

          const scoreSpan = document.createElement('span');
          scoreSpan.className = 'score';
          scoreSpan.textContent = `${player.name.value}: ${player.score.value}`;
          scoreListDiv.appendChild(scoreSpan);

          player.score.value = ''; //ë‹¤ìŒ ì…ë ¥&í•©ê³„ë¥¼ ìœ„í•´ ië²ˆì§¸ì¸ìì˜ scoreë¥¼ ë¹„ì›€
        }
        scoreListDiv.appendChild(document.createElement('br'));
        scoreListDiv.appendChild(document.createElement('br'));

        scoreList.sort((a, b) => a.score - b.score); //ì´ë•Œì˜ scoreëŠ” pushë°›ì€ ëˆ„ì ì ìˆ˜ì¸ totalScoreì„

        const rankingsDiv = document.getElementById('rankings');
        rankingsDiv.innerHTML = '<h3>ì¢…í•©ë­í‚¹ ğŸ†</h3>';

        //ë™ì ìì²˜ë¦¬
        let rank = 1;
        let prevScore = scoreList[0].score;
        let sameRankCount = 0;
        for (let i = 0; i < scoreList.length; i++) {
          if (scoreList[i].score !== prevScore) {
            rank += sameRankCount; // ë™ì ì ìˆ˜ë§Œí¼ ë‹¤ìŒ ë“±ìˆ˜ë¥¼ ê±´ë„ˆë›°ì–´ ìˆœìœ„ë¥¼ ë§¤ê¹€
            prevScore = scoreList[i].score; // ì´ì „ ì ìˆ˜ë¥¼ í˜„ì¬ ì ìˆ˜ë¡œ ì—…ë°ì´íŠ¸
            sameRankCount = 0; // ë™ì ì ìˆ˜ ì´ˆê¸°í™”
          }
          sameRankCount++; // ë™ì ì ìˆ˜ ì¦ê°€

          //ì¢…í•©ë­í‚¹ ê°±ì‹ 
          const rankDiv = document.createElement('div');
          rankDiv.innerHTML = `<p>${rank}ë“±: ${scoreList[i].name}</p> <span>- - - - ${scoreList[i].score}pt</span><br/>`;
          rankingsDiv.appendChild(rankDiv);
        }

        //ì¡°ê±´ë¶€ ì ìˆ˜ì…ë ¥ë²„íŠ¼ í™œì„±í™” ë‹¤ì‹œ ì„¸íŒ…
        saveScoresBtn.disabled = true;
        scoreCheck();
      }

      //ê°œì¸ë³„ ì ìˆ˜ê¸°ë¡í•œ ëª©ë¡ ìŠ¬ë¼ì´ë“œì—…ë‹¤ìš´
      function toggleScoreList() {
        scoreListBtn.classList.toggle('active');
        scoreListDiv.classList.toggle('active');
      }
      
    </script>
  </body>
</html>
